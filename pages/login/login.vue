<template>
  <view class="xinyi-content">
    <img src="@/static/image/login/logo.jpg" class="logo-image" alt="Logo" />
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%" height="100%"
         viewBox="0 0 1920 1080">
      <defs>
        <filter id="路径_3" x="583.656" y="230.085" width="741.681" height="617.413" filterUnits="userSpaceOnUse">
          <feOffset dy="3" input="SourceAlpha" />
          <feGaussianBlur stdDeviation="5" result="blur" />
          <feFlood flood-color="#00f0ff" />
          <feComposite operator="in" in2="blur" />
          <feComposite in="SourceGraphic" />
        </filter>
        <linearGradient id="linear-gradient" y1="0.5" x2="1" y2="0.5" gradientUnits="objectBoundingBox">
          <stop offset="0" stop-color="#00ddeb" />
          <stop offset="1" stop-color="#007a82" />
        </linearGradient>
      </defs>
      <g id="兵旗1-登录页面" class="cls-1">
        <rect id="矩形_1" data-name="矩形 1"  opacity=0 width=100% height=100% fill="none"/>
        <g class="cls-18" transform="matrix(1, 0, 0, 1, 0, 0)">
          <path id="路径_3-2" data-name="路径 3" class="cls-3"
                d="M768.74-993.248H916.113L935.3-979.174h337.4l28.211-14.074h142.407l15.8,14.074v559.829l-15.8,12.51H768.74l-20.311-12.51V-979.174Z"
                transform="translate(-149.27 1235.83)" />
        </g>
        <path id="路径_5" data-name="路径 5" class="cls-4" d="M1257.835-991.624h-25.909l-18.043,14.342v34.088"
              transform="translate(-617.92 1233.739)" />
        <path id="路径_11" data-name="路径 11" class="cls-4" d="M1213.883-991.624l18.043,14.342"
              transform="translate(-447.339 1234.209)" />
        <path id="路径_12" data-name="路径 12" class="cls-4" d="M1231.926-991.624l-18.043,14.342"
              transform="translate(-84.312 1234.209)" />
        <path id="路径_6" data-name="路径 6" class="cls-4" d="M1213.883-991.624h25.909l18.043,14.342v34.088"
              transform="translate(55.754 1233.739)" />
        <path id="路径_7" data-name="路径 7" class="cls-4" d="M1257.835-943.194h-25.909l-18.043-14.342v-34.088"
              transform="translate(-617.92 1772.192)" />
        <path id="路径_9" data-name="路径 9" class="cls-4" d="M1221.537-956.371l-7.655-5.654v-11.7"
              transform="translate(-600.411 1777.931)" />
        <path id="路径_10" data-name="路径 10" class="cls-4" d="M1213.883-956.371l7.655-5.654v-11.7"
              transform="translate(75.305 1777.931)" />
        <path id="路径_8" data-name="路径 8" class="cls-4" d="M1213.883-943.194h25.909l18.043-14.342v-34.088"
              transform="translate(55.754 1772.192)" />
        <line class="cls-4" x2="12.507" y2="12.507" transform="translate(602.763 523.669)" />
        <line class="cls-4" x1="12.507" y2="12.507" transform="translate(1294.348 523.669)" />
        <line class="cls-4" x2="12.507" y2="12.507" transform="translate(602.763 538.677)" />
        <line class="cls-4" x1="12.507" y2="12.507" transform="translate(1294.348 538.677)" />
        <line class="cls-4" x2="12.507" y2="12.507" transform="translate(602.763 556.186)" />
        <line class="cls-4" x1="12.507" y2="12.507" transform="translate(1294.348 556.186)" />
        <path id="路径_13" data-name="路径 13" class="cls-5"
              d="M703.675,614.7V397.336l-17.847-17.2v-25.8l17.847-14.074H858.029l17.954,14.074h342.769l19.587-14.074h148.533l17.138,14.074v25.8l-17.138,17.2V614.7"
              transform="translate(-89.91 -97.04)" />
        <path id="路径_14" data-name="路径 14" class="cls-5"
              d="M699.924,608.838v234.88l21.637,15.638h641.266l20.448-15.638V608.838"
              transform="translate(-86.377 -29.717)" />
        <rect id="b52d04c688542efbecdac482d1609d4" class="cls-6" width="195" height="97" transform="translate(42 21)" />
        <path id="路径_15" data-name="路径 15" class="cls-7"
              d="M646.5,398.091s127.605-.707,340.208-.707,296.281.707,296.281.707-53.405,2.159-296.281,2.159S646.5,398.091,646.5,398.091Z"
              transform="translate(-10.256 -39.017)" />

        <foreignObject x="840" y="288" width="600" height="50">
          <div style="font-size: 45px; color: #a7faff; white-space: nowrap; overflow: hidden;">
            兵棋客户端
          </div>
        </foreignObject>

        <foreignObject x="675" y="392" width="200" height="50">
          <div style="font-size: 30px; color: #a7faff;">
            用户名
          </div>
        </foreignObject>

        <foreignObject x="675" y="520" width="200" height="50">
          <div style="font-size: 30px; color: #a7faff;">
            密码
          </div>
        </foreignObject>

        <foreignObject x="1149" y="657" width="200" height="50">
          <body xmlns="http://www.w3.org/1999/xhtml">
          <div style="font-size: 24px; color: #a7faff; cursor: pointer;" @click="toReg">
            注册账户
          </div>
          </body>
        </foreignObject>

        <rect id="userid" class="cls-13" width="570" height="52" transform="translate(675 441)" />
        <foreignObject x="675" y="441" width="570" height="52">
          <body xmlns="http://www.w3.org/1999/xhtml">
          <input type="text" placeholder="请输入用户名" v-model="user.loginName"
                 style="width: 100%; height: 100%; font-size: 20px; padding: 10px; box-sizing: border-box;" />
          </body>
        </foreignObject>

        <rect id="password" class="cls-13" width="570" height="52" transform="translate(675 569)" />
        <foreignObject x="675" y="569" width="570" height="52">
          <body xmlns="http://www.w3.org/1999/xhtml">
          <input type="password" placeholder="请输入密码" v-model="user.password"
                 style="width: 100%; height: 100%; font-size: 20px; padding: 10px; box-sizing: border-box;" />
          </body>
        </foreignObject>

        <foreignObject x="675" y="713" width="570" height="52">
          <body xmlns="http://www.w3.org/1999/xhtml">
          <button style="width: 100%; height: 100%;
          font-size: 28px; background: linear-gradient(to right, #00ddeb, #007a82);
          color: #fff; border: 2px solid #00f0ff; cursor: pointer;
          font-family: YuGothicUI-Bold, Yu Gothic UI; font-weight: 700; display: flex;
          justify-content: center; align-items: center;" @click="login">
            登录
          </button>
          </body>
        </foreignObject>

      </g>
    </svg>
  </view>
</template>

<script>
import { login } from '@/api/user.js';
import { initWebSocket, closeSocketTask } from '@/api/websocket.js';
export default {
	data() {
		return {
			user: {
				userName: '',
				password: ''
			}
		};
	},
	onLoad() {
		let user = uni.getStorageSync('user');
		if (user) {
			uni.setStorageSync('user', null);
			closeSocketTask();
		}
	},
	methods: {
		login() {
			if (!this.user.loginName || !this.user.password) {
				return new uni.showToast({
					title: '请输入用户名、密码',
					icon: 'none'
				});
			}
			uni.showLoading({
				title: '登录中...',
				mask: true
			});
			login(this.user)
				.then((res) => {
					uni.hideLoading();
					// console.log(res);
					if (res.data.code === 200) {
						let user = res.data.data.user;
						let token = res.data.data.token;
						uni.setStorageSync('token', token);
						uni.setStorageSync('user', user);
						initWebSocket();
						uni.reLaunch({
							url: '/pages/mode/select'
						});
					}
				})
				.catch((err) => {
					uni.hideLoading();
				});
		},
		toReg() {
			uni.navigateTo({
				url: '/pages/login/register'
			});
		}
	}
};
</script>

<style lang="scss" scoped>
.logo-image {
  position: absolute;
  top: 10px;
  left: 10px;
  width: 10%; /* Adjust the size as needed */
  height: auto;
}
.cls-1 {
  clip-path: url(#clip-兵旗1-登录页面);
}

.cls-3 {
  fill: #001322;
  opacity: 0.7;
}

.cls-14,
.cls-3,
.cls-4,
.cls-5 {
  stroke: #00f0ff;
}

.cls-17,
.cls-4,
.cls-5 {
  fill: none;
}

.cls-4 {
  stroke-width: 6px;
}

.cls-5 {
  stroke-width: 3px;
  opacity: 0.6;
}

.cls-6 {
  fill: url(#pattern);
}

.cls-7 {
  fill: #00f0ff;
}

.cls-10,
.cls-12,
.cls-8 {
  fill: #a7faff;
}

.cls-8 {
  font-size: 48px;
}

.cls-15,
.cls-8 {
  font-family: YuGothicUI-Bold, Yu Gothic UI;
  font-weight: 700;
}

.cls-9 {
  font-family: MicrosoftJhengHeiUIBold, Microsoft JhengHei UI;
  font-weight: 400;
}

.cls-10,
.cls-15 {
  font-size: 30px;
}

.cls-10,
.cls-12 {
  font-family: YuGothicUI-Regular, Yu Gothic UI;
}

.cls-11 {
  font-family: MicrosoftJhengHeiUIRegular, Microsoft JhengHei UI;
}

.cls-12 {
  font-size: 24px;
}

.cls-13,
.cls-15 {
  fill: #fff;
}

.cls-14 {
  stroke-width: 2px;
  fill: url(#linear-gradient);
}

.cls-16 {
  stroke: none;
}

.cls-18 {
  filter: url(#路径_3);
}


.xinyi-content {
  justify-content: center;
  background-image: url('@/static/image/login/bg.jpg');
  background-repeat: no-repeat;
  background-size: cover;
  height: 100vh; /* 使内容垂直居中 */
  overflow: hidden; /* 隐藏滚动条 */
}
.login-form__view {
  width: 300rpx;
  min-height: 60vh;
  padding-top: 10rpx;
  padding-bottom: 10rpx;
  box-shadow: 0 0 10px $uni-border-color;
  background-color: $uni-bg-color;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: 15px; /* 添加圆角 */
  position: relative; /* 使子元素可以使用绝对定位 */
  .login-top__view {
    .logo__image {
      width: 60rpx;
      height: 60rpx;
    }
    .login-title__view {
      text-align: center;
      font-size: $uni-font-size-title;
    }
  }
  .login-input__view {
    width: 80%;
    margin-top: 30rpx;
    .uni-easyinput {
      margin-bottom: 10rpx;
    }
  }
  .login-btn__view {
    width: 100%;
    margin-top: 20rpx;
    display: flex;
    justify-content: center; /* 居中对齐 */
    .login__btn {
      width: 80%; /* 调整宽度 */
      background-color: $xinyi-color-primary;
      color: $uni-text-color-inverse;
      border-radius: 10px; /* 添加圆角 */
      transition: background-color 0.3s ease;
    }
    .login__btn:hover {
      background-color: $xinyi-color-primary-light;
    }
  }
  .register-link {
    position: absolute;
    bottom: 10px;
    right: 10px;
    color: #808080; /* Default gray color */
    font-size: 14px; /* Reduced font size */
    cursor: pointer;
    transition: color 0.3s ease; /* Add transition effect */
    font-family: 'Microsoft YaHei', sans-serif; /* Set font to Microsoft YaHei */
    text-decoration: none; /* Remove underline */
  }

  .register-link:hover {
    color: #ff69b4; /* Pink color on hover */
  }
}
</style>